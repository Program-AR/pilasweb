<html>
<head>
    <script src="../pilasengine/libs/require.js"></script>
    <script src="../pilasengine/libs/Box2dWeb-2.1.a.3.js"></script>

    <script type="text/javascript">
    require.config({
      baseUrl: "../pilasengine",
    });

    // All variables are global in terms of developing pourposes
    require(['main'], function(pilasengine){
      pilas = new pilasengine.Pilas("canvas", '../data/');
      world = new Box2D.Dynamics.b2World(
        new Box2D.Common.Math.b2Vec2(0, 10), //gravity
        true                                 //allow sleep
      );
      fixDef = new Box2D.Dynamics.b2FixtureDef();
      bodyDef = new Box2D.Dynamics.b2BodyDef();

      fixDef.density = 1.0;
      fixDef.friction = 0.5;
      fixDef.restitution = 0.2;

      //create ground
      bodyDef.type = Box2D.Dynamics.b2Body.b2_staticBody;
      bodyDef.position.x = 10;
      bodyDef.position.y = 100;
      fixDef.shape = new Box2D.Collision.Shapes.b2PolygonShape;
      fixDef.shape.SetAsBox(10, 0.5);
      world.CreateBody(bodyDef).CreateFixture(fixDef);

      //create olive
      bodyDef.type = Box2D.Dynamics.b2Body.b2_dynamicBody;
      bodyDef.position = -100;
      fixDef.shape = new Box2D.Collision.Shapes.b2PolygonShape;
      fixDef.shape = new Box2D.Collision.Shapes.b2CircleShape(
          Math.random() + 0.1 //radius
      );

      olive = world.CreateBody(bodyDef);
      olive.CreateFixture(fixDef);

      // world.Step(1 / 60, 10, 10);

      // Pilas objects
      actor = new pilas.actores.Actor();
      pilas.depurador.definir_modos({depuracion: true});
      aceituna = new pilas.actores.Aceituna();
      aceituna.x = 10;
      aceituna.y = 100;

      pilas.eventos.click_de_mouse.conectar(function(e){
        window.setInterval(update, 1000 / 60);
      });

      function update(){
        world.Step(1 / 20, 10, 10);
        aceituna.y = -1 * olive.GetPosition().y;
        console.log(aceituna.y);
      }
    });
    </script>
    <style>
    canvas {
      border: 1px solid gray;
    }
    </style>
</head>
<body>
    <canvas id='canvas' width=320 height=240></canvas>
</body>
</html>
